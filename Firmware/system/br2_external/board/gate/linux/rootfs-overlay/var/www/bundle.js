"use strict";(()=>{var he=(e,s)=>()=>(e&&(s=e(e=0)),s);var at=(e,s)=>()=>(s||e((s={exports:{}}).exports,s),s.exports);function rt(){try{if(typeof window<"u"){let e=window;if(typeof e.CGI_BASE=="string"&&e.CGI_BASE)return e.CGI_BASE;if(typeof e.__CGI_BASE__=="string"&&e.__CGI_BASE__)return e.__CGI_BASE__}}catch{}return"/cgi-bin"}function M(){return typeof window<"u"&&(window.location.protocol==="file:"||!navigator.onLine)}function ot(e){if(!e)return"";let s=new URLSearchParams;for(let[i,a]of Object.entries(e))a!=null&&s.set(i,String(a));let t=s.toString();return t?`?${t}`:""}function He(e,s){if(/^https?:\/\//i.test(s))return s;let t=e.endsWith("/")?e.slice(0,-1):e,i=s.startsWith("/")?s:`/${s}`;return`${t}${i}`}async function Ne(e,s){if(!s)return e;let t=new AbortController,i=setTimeout(()=>t.abort(),s);try{let a=await e;return clearTimeout(i),a}catch(a){throw clearTimeout(i),a}}var ne,_e,B,ye=he(()=>{"use strict";ne=class extends Error{constructor(t,i){super(i);this.status=t;this.name="ApiError"}};_e=class{constructor(s){this.baseUrl=s?.baseUrl??rt(),this.timeoutMs=s?.timeoutMs??8e3}onUnauthorized(s){this.onUnauthorizedCb=s}async get(s,t){if(M())return Promise.reject(new Error("offline"));let i=He(this.baseUrl,`${s}${ot(t)}`),a=fetch(i,{method:"GET",headers:{Accept:"application/json, text/plain, */*","Cache-Control":"no-cache"},credentials:"same-origin"}).then(async l=>{if(!l.ok){let g=l.headers.get("content-type")||"",p="";if(g.includes("application/json"))try{let b=await l.json();b&&typeof b=="object"&&"message"in b&&typeof b.message=="string"?p=b.message:p=JSON.stringify(b)}catch{}else{let b=await l.text().catch(()=>""),r=/<title>(.*?)<\/title>/i.exec(b);p=r?r[1]:""}let h=[`HTTP ${l.status}${l.statusText?" "+l.statusText:""}`,p?`\u2014 ${p}`:"",`at ${i}`].filter(Boolean).join(" ");throw l.status===401&&this.onUnauthorizedCb&&this.onUnauthorizedCb(),new ne(l.status,h)}return(l.headers.get("content-type")||"").includes("application/json")?l.json():l.text()});return Ne(a,this.timeoutMs)}async postForm(s,t){if(M())return Promise.reject(new Error("offline"));let i=He(this.baseUrl,s),a=new URLSearchParams;Object.entries(t).forEach(([d,g])=>{g!=null&&a.set(d,String(g))});let l=fetch(i,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/plain, */*"},body:a}).then(async d=>{if(!d.ok){let p=d.headers.get("content-type")||"",h="";if(p.includes("application/json"))try{let r=await d.json();r&&typeof r=="object"&&"message"in r&&typeof r.message=="string"?h=r.message:h=JSON.stringify(r)}catch{}else{let r=await d.text().catch(()=>""),f=/<title>(.*?)<\/title>/i.exec(r);h=f?f[1]:""}let b=[`HTTP ${d.status}${d.statusText?" "+d.statusText:""}`,h?`\u2014 ${h}`:"",`at ${i}`].filter(Boolean).join(" ");throw d.status===401&&this.onUnauthorizedCb&&this.onUnauthorizedCb(),new ne(d.status,b)}return(d.headers.get("content-type")||"").includes("application/json")?d.json():d.text()});return Ne(l,this.timeoutMs)}},B=new _e});function Ae(){return be}function Fe(e){be=e,localStorage.setItem("lang",e),location.reload()}function n(e){return $e[be][e]||$e.ru[e]||e}var Pe,$e,be,ve=he(()=>{"use strict";Pe=[{value:"ru",label:"RU"},{value:"en",label:"EN"}],$e={ru:{app_title:"RNS Gate \u2014 Configurator",save:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",add:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",delete:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",fill_actual:"\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u0430\u043A\u0442\u0443\u0430\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435",fill_actual_title:"\u0417\u0430\u043F\u0440\u043E\u0441\u0438\u0442\u044C \u0438 \u043F\u043E\u0434\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u0430\u043A\u0442\u0443\u0430\u043B\u044C\u043D\u044B\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F \u0442\u0435\u043A\u0443\u0449\u0435\u0433\u043E \u0440\u0430\u0437\u0434\u0435\u043B\u0430",saving:"\u0421\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0435...",saved:"\u0418\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u044B.",save_error:"\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F",unsaved_changes:"\u0415\u0441\u0442\u044C \u043D\u0435\u0441\u043E\u0445\u0440\u0430\u043D\u0451\u043D\u043D\u044B\u0435 \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F",settings_applied:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D\u044B",offline_mode:"Offline \u0440\u0435\u0436\u0438\u043C",online_mode:"Online \u0440\u0435\u0436\u0438\u043C",interfaces:"\u0418\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u044B",wifi:"WiFi",ethernet:"Ethernet",lora:"LoRA",not_selected:"\u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D",interface_name:"\u0418\u043C\u044F \u0438\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430",interface:"\u0418\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441",interfaces_saved:"\u0418\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u044B \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u044B",eth_applied:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 Ethernet \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D\u044B",freedv_applied:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 FreeDV \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D\u044B",wifi_applied:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 WiFi \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D\u044B",type_settings:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0442\u0438\u043F\u0430",invalid_ldpc:"\u041D\u0435\u0434\u043E\u043F\u0443\u0441\u0442\u0438\u043C\u044B\u0439 LDPC",invalid_mode:"\u041D\u0435\u0434\u043E\u043F\u0443\u0441\u0442\u0438\u043C\u044B\u0439 Mode",invalid_rate:"\u041D\u0435\u0434\u043E\u043F\u0443\u0441\u0442\u0438\u043C\u044B\u0439 Rate",invalid_mask:"\u041D\u0435\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u0430\u044F \u043C\u0430\u0441\u043A\u0430",invalid_dns1:"\u041D\u0435\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0439 DNS1",invalid_dns2:"\u041D\u0435\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0439 DNS2",invalid_ip:"\u041D\u0435\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0439 IP \u0430\u0434\u0440\u0435\u0441",invalid_gw:"\u041D\u0435\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0439 \u0448\u043B\u044E\u0437",no_rnsd_data:"\u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445 \u043E RNSD.",num_or_name:"\u043D\u043E\u043C\u0435\u0440 \u0438\u043B\u0438 \u0438\u043C\u044F",updating:"\u041E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435...",online:"\u041E\u043D\u043B\u0430\u0439\u043D",offline:"\u041E\u0444\u0444\u043B\u0430\u0439\u043D",offline_cgi_unavailable:"\u041E\u0444\u0444\u043B\u0430\u0439\u043D \u0440\u0435\u0436\u0438\u043C: CGI \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B",offline_save_unavailable:"\u041E\u0444\u0444\u043B\u0430\u0439\u043D \u0440\u0435\u0436\u0438\u043C: \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0435 \u043D\u0430 \u0443\u0441\u0442\u0440\u043E\u0439\u0441\u0442\u0432\u0435 \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u043E",offline_save_unavailable_short:"\u041E\u0444\u0444\u043B\u0430\u0439\u043D \u0440\u0435\u0436\u0438\u043C \u2014 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0435 \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u043E",clear_form_title:"\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F \u0442\u0435\u043A\u0443\u0449\u0435\u0439 \u0444\u043E\u0440\u043C\u044B (\u043B\u043E\u043A\u0430\u043B\u044C\u043D\u043E)",clear_fields:"\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u043F\u043E\u043B\u044F",error:"\u041E\u0448\u0438\u0431\u043A\u0430",eth_save_error:"\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F Ethernet",freedv_save_error:"\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F FreeDV",wifi_save_error:"\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F WiFi",pass_too_short:"\u041F\u0430\u0440\u043E\u043B\u044C \u043D\u0435 \u043A\u043E\u0440\u043E\u0447\u0435 8 \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432",show_pass:"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u043F\u0430\u0440\u043E\u043B\u044C",hide_pass:"\u0421\u043A\u0440\u044B\u0442\u044C \u043F\u0430\u0440\u043E\u043B\u044C",type:"\u0422\u0438\u043F",specify_ssid:"\u0423\u043A\u0430\u0436\u0438\u0442\u0435 SSID",requesting:"\u0412\u044B\u043F\u043E\u043B\u043D\u044F\u0435\u0442\u0441\u044F \u0437\u0430\u043F\u0440\u043E\u0441\u2026",interfaces_list:"\u0421\u043F\u0438\u0441\u043E\u043A \u0438\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u043E\u0432",no_name:"\u0431\u0435\u0437 \u0438\u043C\u0435\u043D\u0438",no_interfaces_added:"\u0418\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u044B \u043D\u0435 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u044B. \u041D\u0430\u0436\u043C\u0438\u0442\u0435 \xAB\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C\xBB.",ssid:"\u0418\u043C\u044F \u0441\u0435\u0442\u0438",password:"\u041F\u0430\u0440\u043E\u043B\u044C (WPA2)",address_mode:"\u0420\u0435\u0436\u0438\u043C \u0430\u0434\u0440\u0435\u0441\u0430\u0446\u0438\u0438",static:"\u0421\u0442\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438\u0439",dhcp:"DHCP",ip_address:"IP \u0430\u0434\u0440\u0435\u0441",mask:"\u041C\u0430\u0441\u043A\u0430",gateway:"\u0428\u043B\u044E\u0437",client:"\u041A\u043B\u0438\u0435\u043D\u0442",ap:"\u0422\u043E\u0447\u043A\u0430 \u0434\u043E\u0441\u0442\u0443\u043F\u0430",load_error:"\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438",ip_settings:"IP-\u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438",mode:"\u0420\u0435\u0436\u0438\u043C",password_label:"\u041F\u0430\u0440\u043E\u043B\u044C",login_title:"\u0410\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u044F",login:"\u0412\u043E\u0439\u0442\u0438",register:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044F",username:"\u0418\u043C\u044F \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",password_confirm:"\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u043F\u0430\u0440\u043E\u043B\u044C",no_account:"\u041D\u0435\u0442 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430? \u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C",have_account:"\u0423\u0436\u0435 \u0435\u0441\u0442\u044C \u0430\u043A\u043A\u0430\u0443\u043D\u0442? \u0412\u043E\u0439\u0434\u0438\u0442\u0435",auth_error:"\u041E\u0448\u0438\u0431\u043A\u0430 \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u0438",reg_error:"\u041E\u0448\u0438\u0431\u043A\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438",pass_mismatch:"\u041F\u0430\u0440\u043E\u043B\u0438 \u043D\u0435 \u0441\u043E\u0432\u043F\u0430\u0434\u0430\u044E\u0442",section_placeholder:"\u2014 \u0437\u0434\u0435\u0441\u044C \u043F\u043E\u0437\u0436\u0435 \u043F\u043E\u044F\u0432\u044F\u0442\u0441\u044F \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438",users:"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0438",limit_one_config:"\u041E\u0433\u0440\u0430\u043D\u0438\u0447\u0435\u043D\u0438\u0435: \u043E\u0434\u0438\u043D \u0438\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441",add_user:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",user_management:"\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F\u043C\u0438",registration_closed:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044F \u0437\u0430\u043A\u0440\u044B\u0442\u0430. \u041E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443.",label_bandwidth:"\u041F\u043E\u043B\u043E\u0441\u0430 \u043F\u0440\u043E\u043F\u0443\u0441\u043A\u0430\u043D\u0438\u044F (kHz)",label_bind_host:"Bind host",label_busy_chip:"Busy Chip",label_busy_pin:"Busy Pin",label_coding_rate:"Coding Rate",label_freedv:"FreeDV",label_frequency:"\u0427\u0430\u0441\u0442\u043E\u0442\u0430 (MHz)",label_host:"\u0425\u043E\u0441\u0442",label_irq_chip:"IRQ Chip",label_irq_pin:"IRQ Pin",label_ldpc:"LDPC",label_loraspi:"LoraSPI",label_mode:"\u0420\u0435\u0436\u0438\u043C",label_nrst_chip:"NRST Chip",label_nrst_pin:"NRST Pin",label_port:"\u041F\u043E\u0440\u0442",label_radio_preset:"\u041F\u0440\u0435\u0441\u0435\u0442 \u0440\u0430\u0434\u0438\u043E",label_rate:"\u0421\u043A\u043E\u0440\u043E\u0441\u0442\u044C",label_rnode:"RNode",label_rx_en_chip:"RX EN Chip",label_rx_en_pin:"RX EN Pin",label_serial_port:"\u0421\u0435\u0440\u0438\u0439\u043D\u044B\u0439 \u043F\u043E\u0440\u0442",label_spi_chip:"SPI Chip",label_spi_pin:"SPI Pin",label_spread_factor:"Spread Factor",label_autointerface:"\u0410\u0432\u0442\u043E \u0438\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441",label_tcp_client:"TCP \u043A\u043B\u0438\u0435\u043D\u0442",label_tcp_server:"TCP \u0441\u0435\u0440\u0432\u0435\u0440",label_tx_en_chip:"TX EN Chip",label_tx_en_pin:"TX EN Pin",label_tx_power:"\u041C\u043E\u0449\u043D\u043E\u0441\u0442\u044C (dBm)"},en:{app_title:"RNS Gate \u2014 Configurator",save:"Save",add:"Add",delete:"Delete",fill_actual:"Fill actual data",fill_actual_title:"Request and fill actual values for the current section",saving:"Saving...",saved:"Changes sent.",save_error:"Save error",unsaved_changes:"There are unsaved changes",settings_applied:"Settings applied",offline_mode:"Offline mode",online_mode:"Online mode",interfaces:"Interfaces",wifi:"WiFi",ethernet:"Ethernet",lora:"LoRA",not_selected:"not selected",interface_name:"Interface name",interface:"Interface",interfaces_saved:"Interfaces saved",eth_applied:"Ethernet settings applied",freedv_applied:"FreeDV settings applied",wifi_applied:"WiFi settings applied",type_settings:"Type settings",invalid_ldpc:"Invalid LDPC",invalid_mode:"Invalid Mode",invalid_rate:"Invalid Rate",invalid_mask:"Invalid mask",invalid_dns1:"Invalid DNS1",invalid_dns2:"Invalid DNS2",invalid_ip:"Invalid IP address",invalid_gw:"Invalid gateway",no_rnsd_data:"No RNSD data.",num_or_name:"number or name",updating:"Updating...",online:"Online",offline:"Offline",offline_cgi_unavailable:"Offline mode: CGI unavailable",offline_save_unavailable:"Offline mode: saving to device unavailable",offline_save_unavailable_short:"Offline mode \u2014 saving unavailable",clear_form_title:"Clear current form values (locally)",clear_fields:"Clear fields",error:"Error",eth_save_error:"Ethernet save error",freedv_save_error:"FreeDV save error",wifi_save_error:"WiFi save error",pass_too_short:"Password must be at least 8 characters",show_pass:"Show password",hide_pass:"Hide password",type:"Type",specify_ssid:"Specify SSID",requesting:"Requesting\u2026",interfaces_list:"Interfaces list",no_name:"no name",no_interfaces_added:'No interfaces added. Click "Add".',ssid:"Network name (SSID)",password:"Password (WPA2)",address_mode:"Address mode",static:"Static",dhcp:"DHCP",ip_address:"IP address",mask:"Mask",gateway:"Gateway",client:"Client",ap:"Access Point",load_error:"Load error",ip_settings:"IP settings",mode:"Mode",password_label:"Password",login_title:"Authorization",login:"Login",register:"Register",username:"Username",password_confirm:"Confirm password",no_account:"No account? Register",have_account:"Already have an account? Login",auth_error:"Authorization error",reg_error:"Registration error",pass_mismatch:"Passwords do not match",section_placeholder:"\u2014 settings will appear here later",users:"Users",limit_one_config:"Limit: one interface",add_user:"Add user",user_management:"User management",registration_closed:"Registration is closed. Contact the administrator.",label_bandwidth:"Bandwidth (kHz)",label_bind_host:"Bind host",label_busy_chip:"Busy Chip",label_busy_pin:"Busy Pin",label_coding_rate:"Coding Rate",label_freedv:"FreeDV",label_frequency:"Frequency (MHz)",label_host:"Host",label_irq_chip:"IRQ Chip",label_irq_pin:"IRQ Pin",label_ldpc:"LDPC",label_loraspi:"LoraSPI",label_mode:"Mode",label_nrst_chip:"NRST Chip",label_nrst_pin:"NRST Pin",label_port:"Port",label_radio_preset:"Radio Preset",label_rate:"Rate",label_rnode:"RNode",label_rx_en_chip:"RX EN Chip",label_rx_en_pin:"RX EN Pin",label_serial_port:"Serial Port",label_spi_chip:"SPI Chip",label_spi_pin:"SPI Pin",label_spread_factor:"Spread Factor",label_autointerface:"Auto Interface",label_tcp_client:"TCP Client",label_tcp_server:"TCP Server",label_tx_en_chip:"TX EN Chip",label_tx_en_pin:"TX EN Pin",label_tx_power:"TX Power (dBm)"}},be=localStorage.getItem("lang")||"ru"});var Q,Be=he(()=>{"use strict";ye();ve();Q=class e{constructor(){this.app=null;this.onAuthenticated=null;this.user=null;this.app=document.getElementById("app"),B.onUnauthorized(()=>{this.user=null,this.renderLogin()})}static getInstance(){return e.instance||(e.instance=new e),e.instance}isAdmin(){return this.user?.is_admin||!1}getCurrentUser(){return this.user?.username||null}async checkAuth(s){if(this.onAuthenticated=s,M()){s();return}try{let t=await B.get("/auth/status");t&&t.authenticated?(this.user={username:t.username||"",is_admin:t.is_admin===!0||t.is_admin===1||t.is_admin==="1"},s()):t&&t.no_users?this.renderRegister(!0):this.renderLogin()}catch(t){t instanceof ne&&t.status===401?this.renderLogin():(console.warn("Auth check failed or server unreachable, proceeding in offline mode",t),s())}}renderLogin(){if(!this.app)return;this.app.innerHTML=`
      <div class="auth-page">
        <div class="auth-card">
          <div class="auth-header">
            <h1>${n("login_title")}</h1>
          </div>
          <form id="login-form" class="auth-form">
            <div class="auth-field">
              <label for="username">${n("username")}</label>
              <input type="text" id="username" required autocomplete="username">
            </div>
            <div class="auth-field">
              <label for="password">${n("password_label")}</label>
              <input type="password" id="password" required autocomplete="current-password">
            </div>
            <button type="submit" class="btn primary">${n("login")}</button>
            <div id="auth-error" class="hint error" style="display: none;"></div>
          </form>
          <div class="auth-footer" id="auth-footer">
            <a href="#" id="go-to-register">${n("no_account")}</a>
          </div>
        </div>
      </div>
    `,document.getElementById("login-form").addEventListener("submit",async i=>{i.preventDefault();let a=document.getElementById("username").value,l=document.getElementById("password").value,d=document.getElementById("auth-error");try{let g=await B.postForm("/auth/login",{username:a,password:l});this.user={username:g.username||a,is_admin:g.is_admin===!0||g.is_admin===1||g.is_admin==="1"},this.onAuthenticated&&this.onAuthenticated()}catch(g){d.textContent=n("auth_error")+": "+(g.message||g),d.style.display="block"}}),document.getElementById("go-to-register")?.addEventListener("click",async i=>{i.preventDefault();try{let a=await B.get("/auth/status");if(a&&a.no_users)this.renderRegister(!0);else{let l=document.getElementById("auth-footer");l&&(l.innerHTML=`<span class="hint">${n("registration_closed")}</span>`)}}catch{this.renderRegister()}})}renderRegister(s=!1){if(!this.app)return;this.app.innerHTML=`
      <div class="auth-page">
        <div class="auth-card">
          <div class="auth-header">
            <h1>${s?n("register")+" (Admin)":n("register")}</h1>
          </div>
          <form id="register-form" class="auth-form">
            <div class="auth-field">
              <label for="username">${n("username")}</label>
              <input type="text" id="username" required autocomplete="username">
            </div>
            <div class="auth-field">
              <label for="password">${n("password_label")}</label>
              <input type="password" id="password" required autocomplete="new-password">
            </div>
            <div class="auth-field">
              <label for="password_confirm">${n("password_confirm")}</label>
              <input type="password" id="password_confirm" required autocomplete="new-password">
            </div>
            <button type="submit" class="btn primary">${n("register")}</button>
            <div id="auth-error" class="hint error" style="display: none;"></div>
          </form>
          <div class="auth-footer">
            <a href="#" id="go-to-login">${n("have_account")}</a>
          </div>
        </div>
      </div>
    `,document.getElementById("register-form").addEventListener("submit",async a=>{a.preventDefault();let l=document.getElementById("username").value,d=document.getElementById("password").value,g=document.getElementById("password_confirm").value,p=document.getElementById("auth-error");if(d!==g){p.textContent=n("pass_mismatch"),p.style.display="block";return}try{let h=await B.postForm("/auth/register",{username:l,password:d});this.user={username:h.username||l,is_admin:h.is_admin===!0||h.is_admin===1||h.is_admin==="1"},this.onAuthenticated&&this.onAuthenticated()}catch(h){p.textContent=n("reg_error")+": "+(h.message||h),p.style.display="block"}}),document.getElementById("go-to-login")?.addEventListener("click",a=>{a.preventDefault(),this.renderLogin()})}}});var wt=at(()=>{ye();ve();Be();var Re="M12 5c-5 0-9.27 3.11-11 7 1.73 3.89 6 7 11 7s9.27-3.11 11-7c-1.73-3.89-6-7-11-7Zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10Zm0-2.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z",lt="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.82l2.93 2.93C20.88 15.51 22 13.88 22 12c-1.73-3.89-6-7-11-7-1.25 0-2.43.19-3.54.54l2.72 2.72C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.03 1 12c1.73 3.89 6 7 11 7 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z",dt="autofillMode";function Ge(){try{return localStorage.getItem(dt)==="fill"?"fill":"hints"}catch{return"hints"}}var Xe="profile_wifi",Ye="profile_ethernet";function Qe(e,s){try{let t=e==="wifi"?Xe:Ye;localStorage.setItem(t,JSON.stringify(s||{}))}catch{}}function Ze(e){try{let s=e==="wifi"?Xe:Ye,t=localStorage.getItem(s);if(!t)return;let i=JSON.parse(t);if(i&&typeof i=="object")return i}catch{}}var me=[{id:"interfaces",title:"Interfaces"},{id:"wifi",title:"WiFi"},{id:"ethernet",title:"Ethernet"},{id:"lora",title:"LoRA"}];function et(){let e=[...me];return Q.getInstance().isAdmin()&&e.push({id:"users",title:n("users")}),e}function ct(){let e=document.getElementById("app");if(!e)return;let s=document.createElement("div");s.className="app-shell";let t=document.createElement("aside");t.className="sidebar";let i=document.createElement("div");i.className="logo",i.textContent=n("app_title"),t.appendChild(i);let a=document.createElement("select");a.className="lang-select sidebar-lang",Pe.forEach(_=>{let v=document.createElement("option");v.value=_.value,v.textContent=_.label,Ae()===_.value&&(v.selected=!0),a.appendChild(v)}),a.addEventListener("change",()=>Fe(a.value)),t.appendChild(a);let l=document.createElement("nav");l.className="menu",et().forEach((_,v)=>{let o=document.createElement("button");o.className="menu-item"+(v===0?" active":""),o.textContent=n(_.id)||_.title,o.setAttribute("data-id",_.id),o.addEventListener("click",()=>De(_.id)),l.appendChild(o)}),t.appendChild(l);let d=document.createElement("main");d.className="content";let g=document.createElement("header");g.className="content-header";let p=document.createElement("h1");p.id="section-title",g.appendChild(p);let h=document.createElement("div");h.id="net-status",h.className="status";let b=document.createElement("button");b.id="if-save-btn",b.className="btn primary",b.type="button",b.textContent=n("save"),b.disabled=!0,b.style.display="none",b.addEventListener("click",async()=>{z==="interfaces"?await gt():Z&&await Z()}),g.appendChild(b);let r=document.createElement("button");r.id="if-add-btn",r.className="btn",r.type="button",r.textContent=n("add"),r.style.display="none",r.addEventListener("click",()=>{ft()}),g.appendChild(r);let f=document.createElement("button");f.id="if-del-btn",f.className="btn danger",f.type="button",f.textContent=n("delete"),f.disabled=!0,f.style.display="none",f.addEventListener("click",()=>{mt()}),g.appendChild(f);let w=document.createElement("button");w.id="fill-current-btn",w.className="btn",w.type="button",w.textContent=n("fill_actual"),w.title=n("fill_actual_title"),w.addEventListener("click",async()=>{if(z)try{let _=w.getBoundingClientRect();_.width&&_.height&&(w.style.width=`${Math.round(_.width)}px`,w.style.height=`${Math.round(_.height)}px`),w.disabled=!0,await _t()}finally{w.disabled=!1,w.style.width="",w.style.height=""}}),g.appendChild(w),le(w,n("updating"));let E=document.createElement("button");E.id="reset-fields-btn",E.className="btn",E.type="button",E.textContent=n("clear_fields"),E.title=n("clear_form_title"),E.addEventListener("click",()=>{yt()}),g.appendChild(E),g.appendChild(h),d.appendChild(g);let y=document.createElement("section");y.className="content-body",y.id="content-body",d.appendChild(y),s.appendChild(t),s.appendChild(d);let L=document.createElement("div");L.id="toast-container",s.appendChild(L),e.innerHTML="",e.appendChild(s),De(me[0].id)}var z=me[0].id,Z=null;function De(e){document.querySelectorAll(".menu-item").forEach(r=>{r instanceof HTMLButtonElement&&r.classList.toggle("active",r.getAttribute("data-id")===e)});let s=et().find(r=>r.id===e)??me[0],t=document.getElementById("section-title"),i=document.getElementById("content-body");if(t&&(t.textContent=s.title),i){let r=i.offsetHeight;i.style.minHeight=r?`${r}px`:"",i.classList.add("switching"),i.scrollTop=0}z=e;let a=document.getElementById("fill-current-btn"),l=document.getElementById("reset-fields-btn"),d=document.getElementById("if-add-btn"),g=document.getElementById("if-del-btn"),p=document.getElementById("if-save-btn"),h=e==="interfaces",b=["interfaces","wifi","ethernet","lora","freedv"];a&&(a.style.display=h?"none":""),l&&(l.style.display=h?"none":""),d&&(d.style.display=h?"":"none"),g&&(g.style.display=h?"":"none"),p&&(p.style.display=b.includes(e)?"":"none"),h?U():Z=null,pt(),ue(s.id).catch(()=>{i&&(i.textContent=`${n(s.id)} ${n("section_placeholder")}`)}).finally(()=>{i&&(i.classList.remove("switching"),i.style.minHeight="")})}async function ue(e){let s=document.getElementById("content-body");try{S("busy","");let t=await B.get(`/${e}/info`);if(s)if(e==="wifi")Ue(pe(e,t));else if(e==="ethernet")Ve(pe(e,t));else if(e==="lora")ze(pe(e,t));else if(e==="freedv")Je(pe(e,t));else if(e==="rnsd")We(t);else if(e==="interfaces"){let i=st(t),a=[];if(Array.isArray(i))a=i;else if(typeof i=="string")try{let l=JSON.parse(i);Array.isArray(l)&&(a=l)}catch{}a.length>0&&(G(a),D=JSON.stringify(a),localStorage.setItem(ae,D)),oe()}else if(e==="users")vt(t);else{let i=document.createElement("pre");i.className="code",i.textContent=typeof t=="string"?t:JSON.stringify(t,null,2),s.innerHTML="",s.appendChild(i)}S("ok","")}catch(t){if(e==="wifi"){s&&Ue(void 0),M()?S("offline",n("offline_cgi_unavailable")):S("error",`${n("load_error")}: ${t?.message||t}`);return}else if(e==="ethernet"){s&&Ve(void 0),M()?S("offline",n("offline_cgi_unavailable")):S("error",`${n("load_error")}: ${t?.message||t}`);return}else if(e==="lora"){s&&ze(void 0),M()?S("offline",n("offline_cgi_unavailable")):S("error",`${n("load_error")}: ${t?.message||t}`);return}else if(e==="freedv"){s&&Je(void 0),M()?S("offline",n("offline_cgi_unavailable")):S("error",`${n("load_error")}: ${t?.message||t}`);return}else if(e==="rnsd"){s&&We(void 0),M()?S("offline",n("offline_cgi_unavailable")):S("error",`${n("load_error")}: ${t?.message||t}`);return}else if(e==="interfaces"){s&&oe(),M()?S("offline",n("offline_cgi_unavailable")):S("error",`${n("load_error")}: ${t?.message||t}`);return}else throw M()?S("offline",n("offline_cgi_unavailable")):S("error",`${n("load_error")}: ${t?.message||t}`),t}}function pt(){M()?S("offline",n("offline_cgi_unavailable")):S("ok","")}var tt="interfaces_config",xe="interfaces_current_id",ae="interfaces_saved_baseline",D=null,fe={"Short Turbo (21.88 kbps, 140dB)":{bw:500,sf:7,cr:5},"Short Fast (10.94 kbps, 143dB)":{bw:250,sf:7,cr:5},"Short Slow (6.25 kbps, 145.5dB)":{bw:250,sf:8,cr:5},"Medium Fast (3.52 kbps, 148dB)":{bw:250,sf:9,cr:5},"Medium Slow (1.95 kbps, 150.5dB)":{bw:250,sf:10,cr:5},"Long Turbo (1.34 kbps, 150dB)":{bw:500,sf:11,cr:8},"Long Fast (1.07 kbps, 153dB)":{bw:250,sf:11,cr:5},"Long Moderate (0.34 kbps, 156dB)":{bw:125,sf:11,cr:8},"Long Slow (0.18 kbps, 158.5dB)":{bw:125,sf:12,cr:8}},Se=[{value:"autointerface",label:n("label_autointerface"),fields:[]},{value:"tcp_client",label:n("label_tcp_client"),fields:[{key:"host",label:n("label_host"),type:"text",default:""},{key:"port",label:n("label_port"),type:"number",default:5e3}]},{value:"tcp_server",label:n("label_tcp_server"),fields:[{key:"bind_host",label:n("label_bind_host"),type:"text",default:"0.0.0.0"},{key:"port",label:n("label_port"),type:"number",default:5e3}]},{value:"rnode",label:n("label_rnode"),fields:[{key:"serial",label:n("label_serial_port"),type:"text",default:"/dev/ttyUSB0"},{key:"tx_power",label:n("label_tx_power"),type:"number",default:20},{key:"preset",label:n("label_radio_preset"),type:"select",default:n("not_selected"),options:[n("not_selected"),...Object.keys(fe)]},{key:"frequency",label:n("label_frequency"),type:"number",default:868},{key:"bandwidth",label:n("label_bandwidth"),type:"select",default:125,options:["7.8","10.4","15.6","20.8","31.25","41.7","62.5","125","250","500","1625"]},{key:"coding_rate",label:n("label_coding_rate"),type:"select",default:5,options:["5","6","7","8"]},{key:"spread_factor",label:n("label_spread_factor"),type:"select",default:7,options:["5","6","7","8","9","10","11","12"]}]},{value:"freedv",label:n("label_freedv"),fields:[{key:"mode",label:n("label_mode"),type:"select",default:"FSK2",options:["FSK2","FSK4"]},{key:"rate",label:n("label_rate"),type:"select",default:"500",options:["500","200","100","50","20"]},{key:"ldpc",label:n("label_ldpc"),type:"select",default:"768/256",options:["768/256","512/256"]}]},{value:"loraspi",label:n("label_loraspi"),fields:[{key:"spi_chip",label:n("label_spi_chip"),type:"text",default:"spi0"},{key:"spi_pin",label:n("label_spi_pin"),type:"number",default:0},{key:"irq_chip",label:n("label_irq_chip"),type:"text",default:"gpiochip1"},{key:"irq_pin",label:n("label_irq_pin"),type:"text",default:""},{key:"busy_chip",label:n("label_busy_chip"),type:"text",default:"gpiochip1"},{key:"busy_pin",label:n("label_busy_pin"),type:"text",default:""},{key:"nrst_chip",label:n("label_nrst_chip"),type:"text",default:"gpiochip1"},{key:"nrst_pin",label:n("label_nrst_pin"),type:"text",default:""},{key:"txen_chip",label:n("label_tx_en_chip"),type:"text",default:"gpiochip1"},{key:"txen_pin",label:n("label_tx_en_pin"),type:"text",default:""},{key:"rxen_chip",label:n("label_rx_en_chip"),type:"text",default:"gpiochip1"},{key:"rxen_pin",label:n("label_rx_en_pin"),type:"text",default:""},{key:"tx_power",label:n("label_tx_power"),type:"number",default:20},{key:"preset",label:n("label_radio_preset"),type:"select",default:n("not_selected"),options:[n("not_selected"),...Object.keys(fe)]},{key:"frequency",label:n("label_frequency"),type:"number",default:868},{key:"bandwidth",label:n("label_bandwidth"),type:"select",default:125,options:["7.8","10.4","15.6","20.8","31.25","41.7","62.5","125","250","500","1625"]},{key:"coding_rate",label:n("label_coding_rate"),type:"select",default:5,options:["5","6","7","8"]},{key:"spread_factor",label:n("label_spread_factor"),type:"select",default:7,options:["5","6","7","8","9","10","11","12"]}]}];function K(){try{let e=localStorage.getItem(tt);if(!e)return[];let s=JSON.parse(e);if(Array.isArray(s))return s}catch{}return[]}function G(e){try{localStorage.setItem(tt,JSON.stringify(e))}catch{}}function Ce(){try{return localStorage.getItem(xe)}catch{return null}}function re(e){try{e?localStorage.setItem(xe,e):localStorage.removeItem(xe)}catch{}}function Te(e){return Se.find(s=>s.value===e)||Se[0]}function we(e){return Te(e).label}function nt(e){let s=Te(e),t={};return s.fields.forEach(i=>t[i.key]=i.default),t}function ut(e){let s="iface",t=1;for(;e.some(i=>i.name===`${s}-${t}`);)t++;return`${s}-${t}`}function oe(){let e=c("content-body"),s=K();if(D===null&&(D=localStorage.getItem(ae),D===null)){D=JSON.stringify(s);try{localStorage.setItem(ae,D)}catch{}}let t=Ce();!t&&s.length&&(t=s[0].id,re(t));let i=s.find(m=>m.id===t)||null;e.innerHTML="",U();let a=document.createElement("div");if(a.className="form",!s.length){let m=document.createElement("div");m.className="form-section",m.innerHTML=`<div class="form-title">${n("interfaces")}</div><div>${n("no_interfaces_added")}</div>`,a.appendChild(m),e.appendChild(a);return}let l=document.createElement("div");l.className="form-section",l.innerHTML=`<div class="form-title">${n("interfaces_list")}</div>`;let d=document.createElement("div");d.className="form-grid";let g=document.createElement("label");g.setAttribute("for","if-select"),g.textContent=n("interface");let p=document.createElement("select");if(p.id="if-select",s.forEach(m=>{let x=document.createElement("option");x.value=m.id,x.textContent=`${m.name||`(${n("no_name")})`} \u2014 ${we(m.type)}`,m.id===t&&(x.selected=!0),p.appendChild(x)}),p.addEventListener("change",()=>{re(p.value),oe()}),d.appendChild(g),d.appendChild(p),l.appendChild(d),a.appendChild(l),!i){e.appendChild(a);return}let h=document.createElement("div");h.className="form-section";let b=document.createElement("div");b.className="form-grid";let r=document.createElement("label");r.setAttribute("for","if-name"),r.textContent=n("interface_name");let f=document.createElement("input");f.id="if-name",f.type="text",f.value=i.name,f.addEventListener("input",()=>{let m=K(),x=m.find(H=>H.id===i.id);if(x){x.name=f.value,G(m);for(let H of Array.from(p.options))if(H.value===i.id){H.textContent=`${x.name||`(${n("no_name")})`} \u2014 ${we(x.type)}`;break}U()}}),b.appendChild(r),b.appendChild(f),h.appendChild(b),a.appendChild(h);let w=document.createElement("div");w.className="form-section";let E=document.createElement("div");E.className="form-grid";let y=document.createElement("label");y.setAttribute("for","if-type"),y.textContent=n("type");let L=document.createElement("select");L.id="if-type",Se.forEach(m=>{let x=document.createElement("option");x.value=m.value,x.textContent=m.label,m.value===i.type&&(x.selected=!0),L.appendChild(x)}),L.addEventListener("change",()=>{let m=K(),x=m.find(H=>H.id===i.id);if(x){x.type=L.value,x.settings=nt(x.type),G(m);for(let H of Array.from(p.options))if(H.value===i.id){H.textContent=`${x.name||`(${n("no_name")})`} \u2014 ${we(x.type)}`;break}u(i.id),U()}}),E.appendChild(y),E.appendChild(L),w.appendChild(E),a.appendChild(w);let _=document.createElement("div");_.className="form-section";let v=document.createElement("div");v.className="form-title",v.textContent=n("type_settings");let o=document.createElement("div");o.id="if-settings",_.appendChild(v),_.appendChild(o),a.appendChild(_),e.appendChild(a),u(i.id);function u(m){let x=c("if-settings");if(!x)return;let N=K().find(C=>C.id===m);if(!N){x.innerHTML="";return}let T=Te(N.type);if(x.innerHTML="",T.value==="loraspi"){let C={};T.fields.forEach(k=>{C[k.key]=k.default});let P=document.createElement("div");P.className="gpio-table";let F=document.createElement("div");F.className="gpio-header";let A=document.createElement("div");A.className="gpio-header",A.textContent="Chip";let R=document.createElement("div");R.className="gpio-header",R.textContent="Pin",P.appendChild(F),P.appendChild(A),P.appendChild(R);let ie=[{title:"SPI",chipKey:"spi_chip",pinKey:"spi_pin",pinType:"number"},{title:"IRQ",chipKey:"irq_chip",pinKey:"irq_pin",pinType:"text"},{title:"Busy",chipKey:"busy_chip",pinKey:"busy_pin",pinType:"text"},{title:"NRST",chipKey:"nrst_chip",pinKey:"nrst_pin",pinType:"text"},{title:"TX EN",chipKey:"txen_chip",pinKey:"txen_pin",pinType:"text"},{title:"RX EN",chipKey:"rxen_chip",pinKey:"rxen_pin",pinType:"text"}],ee=(k,X)=>{let q=K(),Y=q.find(te=>te.id===m);Y&&(Y.settings[k]=X,G(q),U())};ie.forEach(k=>{let X=document.createElement("div");X.className="gpio-row-title",X.textContent=k.title,P.appendChild(X);let q=document.createElement("input");q.id=`if-field-${k.chipKey}`,q.type="text";let Y=C[k.chipKey],te=N.settings[k.chipKey];q.placeholder=Y==null?"":String(Y),te==null||String(te)===String(Y??"")?q.value="":q.value=String(te),q.addEventListener("input",()=>{ee(k.chipKey,q.value)}),P.appendChild(q);let W=document.createElement("input");W.id=`if-field-${k.pinKey}`,W.type=k.pinType==="number"?"number":"text";let de=C[k.pinKey],ce=N.settings[k.pinKey];W.placeholder=k.pinType==="text"?n("num_or_name"):de==null?"":String(de),ce==null||String(ce)===String(de??"")?W.value="":W.value=String(ce),W.addEventListener("input",()=>{if(k.pinType==="number"){let Me=W.value.trim()===""?null:Number(W.value);ee(k.pinKey,Number.isFinite(Me)?Number(Me):null)}else ee(k.pinKey,W.value)}),P.appendChild(W)}),x.appendChild(P);let ge=new Set;ie.forEach(k=>{ge.add(k.chipKey),ge.add(k.pinKey)});let ke=T.fields.filter(k=>!ge.has(k.key));if(ke.length>0){let k=document.createElement("div");k.className="form-grid",k.style.marginTop="20px",x.appendChild(k),ke.forEach(X=>I(X,k,N,m))}return}let J=document.createElement("div");J.className="form-grid",x.appendChild(J),T.fields.forEach(C=>{I(C,J,N,m)})}function I(m,x,H,N){let T=document.createElement("label");T.setAttribute("for",`if-field-${m.key}`),T.textContent=m.label;let J;if(m.type==="select"){let C=document.createElement("select");C.id=`if-field-${m.key}`,(m.options||[]).forEach(P=>{let F=document.createElement("option");F.value=String(P),F.textContent=String(P),C.appendChild(F)}),C.value=String(H.settings[m.key]??m.default),C.addEventListener("change",()=>{let P=K(),F=P.find(A=>A.id===N);if(F){if(F.settings[m.key]=C.value,(H.type==="rnode"||H.type==="loraspi")&&m.key==="preset"&&fe[C.value]){let A=fe[C.value];F.settings.bandwidth=A.bw,F.settings.coding_rate=A.cr,F.settings.spread_factor=A.sf;let R=c("if-field-bandwidth"),ie=c("if-field-coding_rate"),ee=c("if-field-spread_factor");R&&(R.value=String(A.bw)),ie&&(ie.value=String(A.cr)),ee&&(ee.value=String(A.sf))}G(P),U()}}),J=C}else{let C=document.createElement("input");C.id=`if-field-${m.key}`,C.type=m.type==="number"?"number":"text",m.type==="number"&&(C.step="any"),m.min!==void 0&&C.setAttribute("min",String(m.min)),m.max!==void 0&&C.setAttribute("max",String(m.max)),m.datalist&&O(C,m.datalist,m.key);let P=H.settings[m.key]??m.default;C.value=P==null?"":String(P),C.addEventListener("input",()=>{let F=K(),A=F.find(R=>R.id===N);if(A){if(m.type==="number"){let R=C.value.trim()===""?null:Number(C.value);A.settings[m.key]=Number.isFinite(R)?Number(R):null}else A.settings[m.key]=C.value;if((H.type==="rnode"||H.type==="loraspi")&&["bandwidth","coding_rate","spread_factor"].includes(m.key)&&A.settings.preset!==void 0){A.settings.preset=n("not_selected");let R=c("if-field-preset");R&&(R.value=n("not_selected"))}G(F),U()}}),J=C}x.appendChild(T),x.appendChild(J)}}function U(){let e=c("if-add-btn"),s=c("if-del-btn"),t=c("if-save-btn"),i=K(),a=Ce(),l=!!a&&i.some(d=>d.id===a);if(e&&(!Q.getInstance().isAdmin()&&i.length>=1?(e.disabled=!0,e.title=n("limit_one_config")):(e.disabled=!1,e.title="")),s&&(s.disabled=!l),t){if(!D){try{D=localStorage.getItem(ae)}catch{}D||(D=JSON.stringify(i))}let g=JSON.stringify(i)!==D;t.disabled=M()||i.length===0||!g}}function ft(){let e=K(),s=`if-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,t="tcp_client",i={id:s,name:ut(e),type:t,settings:nt(t)};e.push(i),G(e),re(s),U(),oe()}function mt(){let e=K(),s=Ce();if(!s)return;let t=e.findIndex(i=>i.id===s);if(t!==-1){if(e.splice(t,1),G(e),e.length){let i=e[Math.min(t,e.length-1)];re(i.id)}else re(null);U(),oe()}}async function gt(){let e=K();try{if(M())throw new Error("offline");await B.postForm("/interfaces/apply",{payload:JSON.stringify(e)}),S("ok",n("interfaces_saved"));try{D=JSON.stringify(e),localStorage.setItem(ae,D)}catch{}}catch(s){s&&String(s.message||s)==="offline"?S("offline",n("offline_save_unavailable")):S("error",`${n("save_error")}: ${s?.message||s}`)}finally{U()}}var Oe=500,it=0,se=null,Ee=null;function Ie(e,s){let t=document.getElementById("toast-container");if(!t||!e||e==="busy"||Array.from(t.children).find(d=>d.textContent===s))return;let a=document.createElement("div");a.className=`toast ${e}`,a.textContent=s,t.appendChild(a),requestAnimationFrame(()=>{a.classList.add("visible")}),setTimeout(()=>{a.classList.remove("visible"),setTimeout(()=>{a.parentElement&&a.remove()},400)},e==="ok"?3e3:5e3)}function qe(e,s){let t=document.getElementById("net-status");if(!t)return;let i=typeof s=="string"&&s.trim().length>0;t.className=`status${e?" "+e:""}`,t.textContent="",e==="ok"?t.setAttribute("title",n("online")):e==="offline"?t.setAttribute("title",i?s.trim():n("offline")):e==="error"?t.setAttribute("title",i?s.trim():n("error")):e==="busy"?t.setAttribute("title",i?s.trim():n("requesting")):t.removeAttribute("title"),it=Date.now()}function ht(e,s){Ee={kind:e,text:s};let i=Date.now()-it,a=i>=Oe?0:Oe-i;if(se!==null&&(clearTimeout(se),se=null),a===0){let l=Ee;l&&qe(l.kind,l.text)}else se=window.setTimeout(()=>{se=null;let l=Ee;l&&qe(l.kind,l.text)},a)}function S(e,s){typeof s=="string"&&s.trim().length>0&&e!=="busy"&&Ie(e,s.trim()),ht(e,s)}function Ke(){Q.getInstance().checkAuth(ct)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Ke):Ke();function c(e){let s=document.getElementById(e);if(!s)throw new Error(`Element #${e} not found`);return s}function le(e,s){try{let t=e.textContent??"",i=e.offsetWidth;e.textContent=s;let a=e.offsetWidth;e.textContent=t;let l=Math.max(i,a);l&&(e.style.minWidth=`${l}px`)}catch{}}async function _t(){if(!z)return;let e=document.getElementById("content-body"),s=e?e.offsetHeight:0,t=e?e.scrollTop:0;e&&s&&(e.style.minHeight=`${s}px`);try{await ue(z)}catch{}finally{e&&(e.style.minHeight="",e.scrollTop=t)}}function yt(){let e=s=>{let t=document.getElementById(s);t&&t instanceof HTMLInputElement&&(t.value="",t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})))};if(z==="wifi"){["wifi-ssid","wifi-pass","wifi-ip","wifi-mask","wifi-gw","wifi-dns1","wifi-dns2"].forEach(e);return}if(z==="ethernet"){["eth-ip","eth-mask","eth-gw","eth-dns1","eth-dns2"].forEach(e);return}if(z==="lora"){["spi","cs","rst","busy","dio1","rxen","txen"].forEach(e);return}if(z==="freedv"){["freedv-mode","freedv-rate","freedv-ldpc"].forEach(e);return}}function j(e){let s=new Set,t=[];for(let i of e){let a=(i??"").trim();a&&(s.has(a)||(s.add(a),t.push(a)))}return t}function O(e,s,t){let i=`${e.id}-list-${t}`,a=document.getElementById(i);a||(a=document.createElement("datalist"),a.id=i,document.body.appendChild(a));let l=Array.from(a.options).map(d=>d.value);if(l.length===s.length&&l.every((d,g)=>d===s[g])){e.getAttribute("list")!==i&&e.setAttribute("list",i);return}a.innerHTML="",s.forEach(d=>{let g=document.createElement("option");g.value=d,a.appendChild(g)}),e.setAttribute("list",i)}function V(e){return!e||!e.trim().match(/^([0-9]{1,3}\.){3}[0-9]{1,3}$/)?!1:e.split(".").every(t=>{let i=Number(t);return i>=0&&i<=255&&String(i)===t.replace(/^0+(?=\d)/,a=>t==="0"?"0":a)})}function pe(e,s){let t=s&&typeof s=="object"?s:void 0;if(!t&&typeof s=="string"){let a=s.trim();try{let l=JSON.parse(a);l&&typeof l=="object"&&(t=l)}catch{}t||(t=Le(a))}if(t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"data")){let a=t.data;if(typeof a=="string"){let l=a.trim();try{let d=JSON.parse(l);d&&typeof d=="object"&&(a=d)}catch{}typeof a=="string"&&(a=Le(a))}if(a&&typeof a=="object")t=a;else return}if(!t||typeof t!="object")return;let i=bt(t);if(e==="wifi"){let a={};return"mode"in i&&(a.mode=String(i.mode)),"ssid"in i&&(a.ssid=$(i.ssid)),"password"in i&&(a.password=$(i.password)),"ip_config"in i&&(a.ip_config=je(i.ip_config)),"ip"in i&&(a.ip=$(i.ip)),"netmask"in i&&(a.netmask=$(i.netmask)),"gateway"in i&&(a.gateway=$(i.gateway)),"dns1"in i&&(a.dns1=$(i.dns1)),"dns2"in i&&(a.dns2=$(i.dns2)),a}else if(e==="ethernet"){let a={};return"ip_config"in i&&(a.ip_config=je(i.ip_config)),"ip"in i&&(a.ip=$(i.ip)),"netmask"in i&&(a.netmask=$(i.netmask)),"gateway"in i&&(a.gateway=$(i.gateway)),"dns1"in i&&(a.dns1=$(i.dns1)),"dns2"in i&&(a.dns2=$(i.dns2)),a}else if(e==="lora"){let a={};return"spi"in i&&(a.spi=$(i.spi)),"cs"in i&&(a.cs=$(i.cs)),"rst"in i&&(a.rst=$(i.rst)),"busy"in i&&(a.busy=$(i.busy)),"dio1"in i&&(a.dio1=$(i.dio1)),"rxen"in i&&(a.rxen=$(i.rxen)),"txen"in i&&(a.txen=$(i.txen)),a}else if(e==="freedv"){let a={};return"mode"in i&&(a.mode=String(i.mode).toUpperCase()),"rate"in i&&(a.rate=$(i.rate)),"ldpc"in i&&(a.ldpc=$(i.ldpc)),a}}function $(e){return e==null?"":String(e).trim()}function je(e){let s=$(e).toLowerCase();return s==="dhcp"||s==="auto"||s==="automatic"?"dhcp":s==="static"||s==="manual"||s==="fixed"?"static":s||"dhcp"}function Le(e){let s={},t=e.replace(/\r\n?/g,`
`).split(`
`);for(let i of t){let a=i.trim();if(!a||a.startsWith("#")||a.startsWith(";")||a.startsWith("//"))continue;let l="",d="",g=a.indexOf("="),p=a.indexOf(":"),h=-1;g>=0&&(p<0||g<p)?h=g:p>=0&&(h=p),!(h<0)&&(l=a.slice(0,h).trim(),d=a.slice(h+1).trim(),(d.startsWith('"')&&d.endsWith('"')||d.startsWith("'")&&d.endsWith("'"))&&(d=d.slice(1,-1)),l&&(s[l]=d))}return s}function st(e){if(e&&typeof e=="object"){let s=e;if(Object.prototype.hasOwnProperty.call(s,"data"))return s.data;if(Object.prototype.hasOwnProperty.call(s,"config"))return s.config;if(Object.prototype.hasOwnProperty.call(s,"content"))return s.content}return e}function We(e){let s=document.getElementById("content-body");if(!s)return;s.innerHTML="";let t=document.createElement("div");t.className="form";let a=(v=>{let o=st(v),u;if(o&&typeof o=="object")u=o;else if(typeof o=="string"){let N=o.trim();try{let T=JSON.parse(N);T&&typeof T=="object"&&(u=T)}catch{}!u&&N&&(u=Le(N))}if(!u||typeof u!="object")return{raw:o,rnsd:o,spi:void 0};let I=N=>{let T=String(N).toLowerCase();return T.includes("spi")||T.startsWith("gpio")||T.includes("irq")||T.includes("busy")||T.includes("nrst")||T.includes("reset")||T.includes("tx_en")||T.includes("rx_en")||T.includes("txen")||T.includes("rxen")?!0:["miso","mosi","sck","clk","cs","chipselect","baud","speed","mode"].includes(T)||T.startsWith("spi.")},m;if(Object.prototype.hasOwnProperty.call(u,"spi")){let N=u.spi;m=N}let x={},H={};for(let[N,T]of Object.entries(u))N!=="spi"&&(I(N)?H[N]=T:x[N]=T);return m&&typeof m=="object"&&Object.keys(H).length>0?m={...m,...H}:!m&&Object.keys(H).length>0&&(m=H),{raw:o,rnsd:x,spi:m}})(e),l=document.createElement("section");l.className="form-section";let d=document.createElement("div");d.className="form-title",d.textContent="RNSD",l.appendChild(d);let g=document.createElement("pre");if(g.className="code",a.rnsd===void 0||a.rnsd===null||typeof a.rnsd=="object"&&Object.keys(a.rnsd).length===0)if(typeof a.raw=="string")g.textContent=String(a.raw);else if(a.raw&&typeof a.raw=="object")try{g.textContent=JSON.stringify(a.raw,null,2)}catch{g.textContent=String(a.raw)}else g.textContent=n("no_rnsd_data");else if(typeof a.rnsd=="string")g.textContent=a.rnsd;else if(typeof a.rnsd=="object")try{g.textContent=JSON.stringify(a.rnsd,null,2)}catch{g.textContent=String(a.rnsd)}else g.textContent=String(a.rnsd);l.appendChild(g);let p=document.createElement("section");p.className="form-section";let h=document.createElement("div");h.className="form-title",h.textContent="SPI",p.appendChild(h);let b=v=>{if(v!=null){if(typeof v=="string"){let o=v.trim();return o||void 0}if(typeof v=="number")return Number.isFinite(v)?String(Math.trunc(v)):void 0}},r=a.spi&&typeof a.spi=="object"?a.spi:{},f=()=>{let v=b(r.spi_device??r.device??r.dev??r.path??r.spi?.device??r.spi?.dev);if(!v){let o=b(r.spi_port??r.port??r.spi?.port),u=b(r.spi_cs??r.cs??r.chipselect??r.spi?.cs);if(o!==void 0&&u!==void 0){let I=String(o).replace(/\D+/g,""),m=String(u).replace(/\D+/g,"");I!==""&&m!==""&&(v=`/dev/spi${I}.${m}`)}}if(v){let o=/^(?:\/dev\/)?(spi\d+\.\d+)$/.exec(v);o&&(v=`/dev/${o[1]}`)}return v},w=v=>{let o=b(v);if(!o)return;if(o=o.trim(),/^\d+$/.test(o))return`gpiochip${o}`;let u=/^(?:\/dev\/)?(gpiochip\d+)$/.exec(o);return u?u[1]:o},E=v=>b(v),y={spi_device:f(),spi_chip:(()=>{let v=f();if(v){let u=/^\/dev\/(spi\d+)\.(\d+)$/.exec(v);if(u)return u[1]}let o=b(r.spi_port??r.port??r.spi?.port);if(o!==void 0){let u=String(o).replace(/\D+/g,"");if(u!=="")return`spi${u}`}})(),spi_pin:(()=>{let v=f();if(v){let u=/^\/dev\/(spi\d+)\.(\d+)$/.exec(v);if(u)return u[2]}let o=b(r.spi_cs??r.cs??r.chipselect??r.spi?.cs);if(o!==void 0){let u=String(o).replace(/\D+/g,"");if(u!=="")return u}})(),gpio_irq_chip:w(r.gpio_irq_chip??r.irq_chip??r.gpio?.irq?.chip??r.gpio_irq_port??r.irq_port??r.gpio?.irq?.port),gpio_irq_pin:E(r.gpio_irq_pin??r.irq_pin??r.gpio?.irq?.pin),gpio_busy_chip:w(r.gpio_busy_chip??r.busy_chip??r.gpio?.busy?.chip??r.gpio_busy_port??r.busy_port??r.gpio?.busy?.port),gpio_busy_pin:E(r.gpio_busy_pin??r.busy_pin??r.gpio?.busy?.pin),gpio_nrst_chip:w(r.gpio_nrst_chip??r.nrst_chip??r.reset_chip??r.gpio?.nrst?.chip??r.gpio?.reset?.chip??r.gpio_nrst_port??r.nrst_port??r.gpio?.nrst?.port??r.gpio?.reset?.port),gpio_nrst_pin:E(r.gpio_nrst_pin??r.nrst_pin??r.reset_pin??r.gpio?.nrst?.pin??r.gpio?.reset?.pin),gpio_tx_en_chip:w(r.gpio_tx_en_chip??r.tx_en_chip??r.gpio?.tx_en?.chip??r.gpio?.txen?.chip??r.gpio_tx_en_port??r.tx_en_port??r.gpio?.tx_en?.port??r.gpio?.txen?.port),gpio_tx_en_pin:E(r.gpio_tx_en_pin??r.tx_en_pin??r.gpio?.tx_en?.pin??r.gpio?.txen?.pin),gpio_rx_en_chip:w(r.gpio_rx_en_chip??r.rx_en_chip??r.gpio?.rx_en?.chip??r.gpio?.rxen?.chip??r.gpio_rx_en_port??r.rx_en_port??r.gpio?.rx_en?.port??r.gpio?.rxen?.port),gpio_rx_en_pin:E(r.gpio_rx_en_pin??r.rx_en_pin??r.gpio?.rx_en?.pin??r.gpio?.rxen?.pin)},L=document.createElement("div");L.className="form-grid",L.innerHTML=`
    <div class="gpio-table indent-left" style="grid-column: 1 / -1;">
      <div class="gpio-header"></div>
      <div class="gpio-header">Chip</div>
      <div class="gpio-header">Pin</div>

      <div class="gpio-row-title">SPI</div>
      <input id="spi-chip" type="text" inputmode="text" placeholder="spi0">
      <input id="spi-pin" type="text" inputmode="numeric" placeholder="0">

      <div class="gpio-row-title">IRQ</div>
      <input id="gpio-irq-chip" type="text" inputmode="text" placeholder="gpiochip1">
      <input id="gpio-irq-pin" type="text" inputmode="text" placeholder="${n("num_or_name")}">

      <div class="gpio-row-title">Busy</div>
      <input id="gpio-busy-chip" type="text" inputmode="text" placeholder="gpiochip1">
      <input id="gpio-busy-pin" type="text" inputmode="text" placeholder="${n("num_or_name")}">

      <div class="gpio-row-title">NRST</div>
      <input id="gpio-nrst-chip" type="text" inputmode="text" placeholder="gpiochip1">
      <input id="gpio-nrst-pin" type="text" inputmode="text" placeholder="${n("num_or_name")}">

      <div class="gpio-row-title">TX EN</div>
      <input id="gpio-tx-en-chip" type="text" inputmode="text" placeholder="gpiochip1">
      <input id="gpio-tx-en-pin" type="text" inputmode="text" placeholder="${n("num_or_name")}">

      <div class="gpio-row-title">RX EN</div>
      <input id="gpio-rx-en-chip" type="text" inputmode="text" placeholder="gpiochip1">
      <input id="gpio-rx-en-pin" type="text" inputmode="text" placeholder="${n("num_or_name")}">
    </div>
  `,p.appendChild(L),t.appendChild(l),t.appendChild(p),s.appendChild(t);let _=(v,o)=>{let u=document.getElementById(v);u&&(o==null?u.value="":u.value=String(o))};_("spi-chip",y.spi_chip),_("spi-pin",y.spi_pin),_("gpio-irq-chip",y.gpio_irq_chip),_("gpio-irq-pin",y.gpio_irq_pin),_("gpio-busy-chip",y.gpio_busy_chip),_("gpio-busy-pin",y.gpio_busy_pin),_("gpio-nrst-chip",y.gpio_nrst_chip),_("gpio-nrst-pin",y.gpio_nrst_pin),_("gpio-tx-en-chip",y.gpio_tx_en_chip),_("gpio-tx-en-pin",y.gpio_tx_en_pin),_("gpio-rx-en-chip",y.gpio_rx_en_chip),_("gpio-rx-en-pin",y.gpio_rx_en_pin),(()=>{if(!Object.values(y).some(u=>u!==void 0))return null;let o=u=>typeof u=="string"?u:void 0;return{spi_chip:o(y.spi_chip),spi_pin:o(y.spi_pin),gpio_irq_chip:o(y.gpio_irq_chip),gpio_irq_pin:o(y.gpio_irq_pin),gpio_busy_chip:o(y.gpio_busy_chip),gpio_busy_pin:o(y.gpio_busy_pin),gpio_nrst_chip:o(y.gpio_nrst_chip),gpio_nrst_pin:o(y.gpio_nrst_pin),gpio_tx_en_chip:o(y.gpio_tx_en_chip),gpio_tx_en_pin:o(y.gpio_tx_en_pin),gpio_rx_en_chip:o(y.gpio_rx_en_chip),gpio_rx_en_pin:o(y.gpio_rx_en_pin)}})()}function bt(e){let s={},t={ipcfg:"ip_config",ip_config:"ip_config",addrmode:"ip_config",address:"ip",ipaddr:"ip",mask:"netmask",netmask:"netmask",gateway:"gateway",gw:"gateway",dns:"dns1",dns1:"dns1",dns2:"dns2",mode:"mode",ssid:"ssid",pass:"password",password:"password",psk:"password",key:"password",freedv_mode:"mode",freedv_rate:"rate",freedv_ldpc:"ldpc"};for(let[i,a]of Object.entries(e)){let l=i.trim().toLowerCase(),d=t[l]||l;d==="dns1"&&s.dns1!==void 0?s.dns2=a:s[d]=a}return s}function Ue(e){let s=c("content-body"),t={mode:e?.mode==="ap"?"ap":"client",ssid:e?.ssid??"",password:e?.password??"",ip_config:e?.ip_config==="static"?"static":"dhcp",ip:e?.ip??"",netmask:e?.netmask??"",gateway:e?.gateway??"",dns1:e?.dns1??"",dns2:e?.dns2??""};s.innerHTML="";let i=document.createElement("div");i.className="form";let a=document.createElement("div");for(a.innerHTML=`
    <div class="form-section">
      <div class="form-title">WiFi</div>
      <div class="form-grid">
        <label for="wifi-mode">${n("mode")}</label>
        <select id="wifi-mode">
          <option value="client">${n("client")}</option>
          <option value="ap">${n("ap")}</option>
        </select>

        <label for="wifi-ssid">SSID</label>
        <input id="wifi-ssid" type="text" placeholder="${n("ssid")}">

        <label for="wifi-pass">${n("password_label")}</label>
        <div class="input-with-icon">
          <input id="wifi-pass" type="password" placeholder="${n("password")}" autocomplete="current-password">
          <button id="wifi-pass-toggle" type="button" class="icon-btn" aria-pressed="false" aria-label="${n("show_pass")}" title="${n("show_pass")}">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path d="${Re}" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <div class="form-section">
      <div class="form-title">${n("ip_settings")}</div>
      <div class="form-grid">
        <label for="wifi-ipcfg">${n("address_mode")}</label>
        <select id="wifi-ipcfg">
          <option value="dhcp">DHCP</option>
          <option value="static">${n("static")}</option>
        </select>

        <label for="wifi-ip">${n("ip_address")}</label>
        <input id="wifi-ip" type="text" placeholder="192.168.1.10">

        <label for="wifi-mask">${n("mask")}</label>
        <input id="wifi-mask" type="text" placeholder="255.255.255.0">

        <label for="wifi-gw">${n("gateway")}</label>
        <input id="wifi-gw" type="text" placeholder="192.168.1.1">

        <label for="wifi-dns1">DNS 1</label>
        <input id="wifi-dns1" type="text" placeholder="8.8.8.8">

        <label for="wifi-dns2">DNS 2</label>
        <input id="wifi-dns2" type="text" placeholder="1.1.1.1">
      </div>
    </div>

    <div class="form-actions">
      <div id="wifi-hint" class="hint"></div>
    </div>
  `;a.firstChild;)i.appendChild(a.firstChild);s.appendChild(i),c("wifi-mode").value=t.mode||"client",c("wifi-ssid").value=t.ssid||"",c("wifi-pass").value=t.password||"",c("wifi-ipcfg").value=t.ip_config||"dhcp",c("wifi-ip").value=t.ip||"",c("wifi-mask").value=t.netmask||"",c("wifi-gw").value=t.gateway||"",c("wifi-dns1").value=t.dns1||"",c("wifi-dns2").value=t.dns2||"";let l=c("wifi-ipcfg"),d=()=>{let o=l.value==="static";["wifi-ip","wifi-mask","wifi-gw","wifi-dns1","wifi-dns2"].forEach(u=>{c(u).disabled=!o})};l.addEventListener("change",d),d();let g=Ge(),p=Ze("wifi");if(g==="fill"&&p)p.mode&&(c("wifi-mode").value=p.mode),p.ssid!==void 0&&(c("wifi-ssid").value=p.ssid||""),p.password!==void 0&&(c("wifi-pass").value=p.password||""),p.ip_config&&(c("wifi-ipcfg").value=p.ip_config),p.ip!==void 0&&(c("wifi-ip").value=p.ip||""),p.netmask!==void 0&&(c("wifi-mask").value=p.netmask||""),p.gateway!==void 0&&(c("wifi-gw").value=p.gateway||""),p.dns1!==void 0&&(c("wifi-dns1").value=p.dns1||""),p.dns2!==void 0&&(c("wifi-dns2").value=p.dns2||""),d();else if(g==="hints"){let o=j([t.ssid,p?.ssid]);o.length&&O(c("wifi-ssid"),o,"wifi");let u=j([t.ip,p?.ip,"192.168.1.10"]);O(c("wifi-ip"),u,"wifi");let I=j([t.netmask,p?.netmask,"255.255.255.0","255.255.0.0"]);O(c("wifi-mask"),I,"wifi");let m=j([t.gateway,p?.gateway,"192.168.1.1"]);O(c("wifi-gw"),m,"wifi");let x=j([t.dns1,p?.dns1,"8.8.8.8","1.1.1.1"]);O(c("wifi-dns1"),x,"wifi");let H=j([t.dns2,p?.dns2,"1.0.0.1","8.8.4.4"]);O(c("wifi-dns2"),H,"wifi")}let h=c("wifi-pass"),b=document.getElementById("wifi-pass-toggle");if(b){let o=b.querySelector("path");b.addEventListener("click",()=>{let u=h.type==="password";h.type=u?"text":"password",b.setAttribute("aria-pressed",String(u)),b.setAttribute("aria-label",u?n("hide_pass"):n("show_pass")),b.setAttribute("title",u?n("hide_pass"):n("show_pass")),b.classList.toggle("active",u),o&&o.setAttribute("d",u?lt:Re);try{h.focus({preventScroll:!0});let I=h.value.length;h.setSelectionRange(I,I)}catch{}})}let r=c("wifi-hint"),f=c("if-save-btn");le(f,n("saving"));let w=o=>{let u=m=>(m??"").trim(),I={mode:o.mode||"",ssid:u(o.ssid),password:u(o.password),ip_config:o.ip_config||"",ip:u(o.ip),netmask:u(o.netmask),gateway:u(o.gateway),dns1:u(o.dns1),dns2:u(o.dns2)};return I.ip_config!=="static"&&(I.ip="",I.netmask="",I.gateway="",I.dns1="",I.dns2=""),I},E={mode:t.mode,ssid:t.ssid,password:t.password,ip_config:t.ip_config,ip:t.ip,netmask:t.netmask,gateway:t.gateway,dns1:t.dns1,dns2:t.dns2},y=o=>{let u=w(E),I=w(o),m=(u.password||"")!==(I.password||""),x=(u.mode||"")===(I.mode||"")&&(u.ssid||"")===(I.ssid||"")&&(u.ip_config||"")===(I.ip_config||"")&&(u.ip||"")===(I.ip||"")&&(u.netmask||"")===(I.netmask||"")&&(u.gateway||"")===(I.gateway||"")&&(u.dns1||"")===(I.dns1||"")&&(u.dns2||"")===(I.dns2||"");return m||!x},L=()=>{if(M()){f.disabled=!0,r.textContent=n("offline_save_unavailable_short"),r.className="hint warn";return}let o=_(),u=y(o);f.disabled=!u};f.disabled=!0,M()&&(r.textContent=n("offline_save_unavailable_short"),r.className="hint warn"),i.addEventListener("input",L),i.addEventListener("change",()=>{d(),L()});let _=()=>({mode:c("wifi-mode").value,ssid:c("wifi-ssid").value,password:c("wifi-pass").value,ip_config:c("wifi-ipcfg").value,ip:c("wifi-ip").value,netmask:c("wifi-mask").value,gateway:c("wifi-gw").value,dns1:c("wifi-dns1").value,dns2:c("wifi-dns2").value});L();function v(o){if(!o.ssid||o.ssid.trim().length===0)return n("specify_ssid");if(o.mode==="client"&&(!o.password||o.password.length<8))return n("pass_too_short");if(o.ip_config==="static"){if(!V(o.ip))return n("invalid_ip");if(!V(o.netmask))return n("invalid_mask");if(o.gateway&&!V(o.gateway))return n("invalid_gw");if(o.dns1&&!V(o.dns1))return n("invalid_dns1");if(o.dns2&&!V(o.dns2))return n("invalid_dns2")}return null}Z=async()=>{if(M())return;r.textContent="",r.className="hint";let o=_(),u=v(o);if(u){r.textContent=u,r.className="hint error";return}let I=!1;try{let m=f.offsetWidth;m&&(f.style.width=`${m}px`),f.disabled=!0,f.textContent=n("saving"),S("busy",""),await B.postForm("/wifi/apply",o),Qe("wifi",o),r.textContent=n("saved"),r.className="hint success",S("ok",n("wifi_applied")),E={...o},I=!0}catch(m){r.textContent=`${n("save_error")}: ${m?.message||m}`,r.className="hint error",S("error",n("wifi_save_error"))}finally{f.disabled=M()||I,f.textContent=n("save"),f.style.width="",f.disabled||L()}}}function Ve(e){let s=c("content-body"),t={ip_config:e?.ip_config==="static"?"static":"dhcp",ip:e?.ip??"",netmask:e?.netmask??"",gateway:e?.gateway??"",dns1:e?.dns1??"",dns2:e?.dns2??""};s.innerHTML="";let i=document.createElement("div");i.className="form";let a=document.createElement("div");for(a.innerHTML=`
    <div class="form-section">
      <div class="form-title">Ethernet</div>
      <div class="form-grid">
        <label for="eth-ipcfg">${n("address_mode")}</label>
        <select id="eth-ipcfg">
          <option value="dhcp">DHCP</option>
          <option value="static">${n("static")}</option>
        </select>

        <label for="eth-ip">${n("ip_address")}</label>
        <input id="eth-ip" type="text" placeholder="192.168.1.10">

        <label for="eth-mask">${n("mask")}</label>
        <input id="eth-mask" type="text" placeholder="255.255.255.0">

        <label for="eth-gw">${n("gateway")}</label>
        <input id="eth-gw" type="text" placeholder="192.168.1.1">

        <label for="eth-dns1">DNS 1</label>
        <input id="eth-dns1" type="text" placeholder="8.8.8.8">

        <label for="eth-dns2">DNS 2</label>
        <input id="eth-dns2" type="text" placeholder="1.1.1.1">
      </div>
    </div>

    <div class="form-actions">
      <div id="eth-hint" class="hint"></div>
    </div>
  `;a.firstChild;)i.appendChild(a.firstChild);s.appendChild(i),c("eth-ipcfg").value=t.ip_config||"dhcp",c("eth-ip").value=t.ip||"",c("eth-mask").value=t.netmask||"",c("eth-gw").value=t.gateway||"",c("eth-dns1").value=t.dns1||"",c("eth-dns2").value=t.dns2||"";let l=c("eth-ipcfg"),d=()=>{let _=l.value==="static";["eth-ip","eth-mask","eth-gw","eth-dns1","eth-dns2"].forEach(v=>{c(v).disabled=!_})};l.addEventListener("change",d),d();let g=Ge(),p=Ze("ethernet");if(g==="fill"&&p)p.ip_config&&(c("eth-ipcfg").value=p.ip_config),p.ip!==void 0&&(c("eth-ip").value=p.ip||""),p.netmask!==void 0&&(c("eth-mask").value=p.netmask||""),p.gateway!==void 0&&(c("eth-gw").value=p.gateway||""),p.dns1!==void 0&&(c("eth-dns1").value=p.dns1||""),p.dns2!==void 0&&(c("eth-dns2").value=p.dns2||""),d();else if(g==="hints"){let _=j([t.ip,p?.ip,"192.168.1.10"]);O(c("eth-ip"),_,"eth");let v=j([t.netmask,p?.netmask,"255.255.255.0","255.255.0.0"]);O(c("eth-mask"),v,"eth");let o=j([t.gateway,p?.gateway,"192.168.1.1"]);O(c("eth-gw"),o,"eth");let u=j([t.dns1,p?.dns1,"8.8.8.8","1.1.1.1"]);O(c("eth-dns1"),u,"eth");let I=j([t.dns2,p?.dns2,"1.0.0.1","8.8.4.4"]);O(c("eth-dns2"),I,"eth")}let h=c("eth-hint"),b=c("if-save-btn");le(b,n("saving"));let r=_=>{let v=u=>(u??"").trim(),o={ip_config:_.ip_config||"",ip:v(_.ip),netmask:v(_.netmask),gateway:v(_.gateway),dns1:v(_.dns1),dns2:v(_.dns2)};return o.ip_config!=="static"&&(o.ip="",o.netmask="",o.gateway="",o.dns1="",o.dns2=""),o},f={ip_config:t.ip_config,ip:t.ip,netmask:t.netmask,gateway:t.gateway,dns1:t.dns1,dns2:t.dns2},w=_=>{let v=r(f),o=r(_);return!((v.ip_config||"")===(o.ip_config||"")&&(v.ip||"")===(o.ip||"")&&(v.netmask||"")===(o.netmask||"")&&(v.gateway||"")===(o.gateway||"")&&(v.dns1||"")===(o.dns1||"")&&(v.dns2||"")===(o.dns2||""))},E=()=>{if(M()){b.disabled=!0,h.textContent=n("offline_save_unavailable_short"),h.className="hint warn";return}let _=y(),v=w(_);b.disabled=!v};b.disabled=!0,M()&&(h.textContent=n("offline_save_unavailable_short"),h.className="hint warn"),i.addEventListener("input",E),i.addEventListener("change",()=>{d(),E()});let y=()=>({ip_config:c("eth-ipcfg").value,ip:c("eth-ip").value,netmask:c("eth-mask").value,gateway:c("eth-gw").value,dns1:c("eth-dns1").value,dns2:c("eth-dns2").value});E();function L(_){if(_.ip_config==="static"){if(!V(_.ip))return n("invalid_ip");if(!V(_.netmask))return n("invalid_mask");if(_.gateway&&!V(_.gateway))return n("invalid_gw");if(_.dns1&&!V(_.dns1))return n("invalid_dns1");if(_.dns2&&!V(_.dns2))return n("invalid_dns2")}return null}Z=async()=>{if(M())return;h.textContent="",h.className="hint";let _=y(),v=L(_);if(v){h.textContent=v,h.className="hint error";return}let o=!1;try{let u=b.offsetWidth;u&&(b.style.width=`${u}px`),b.disabled=!0,b.textContent=n("saving"),S("busy",""),await B.postForm("/ethernet/apply",_),Qe("ethernet",_),h.textContent=n("saved"),h.className="hint success",S("ok",n("eth_applied")),f={..._},o=!0}catch(u){h.textContent=`${n("save_error")}: ${u?.message||u}`,h.className="hint error",S("error",n("eth_save_error"))}finally{b.disabled=M()||o,b.textContent=n("save"),b.style.width="",b.disabled||E()}}}function ze(e){let s=c("content-body"),t={mode:e?.mode?.toUpperCase?.()==="FSK4"?"FSK4":"FSK2",rate:String(e?.rate??"500"),ldpc:e?.ldpc==="512/256"?"512/256":"768/256"};s.innerHTML="";let i=document.createElement("div");i.className="form";let a=document.createElement("div");for(a.innerHTML=`
    <div class="form-section">
      <div class="form-title">LoRA</div>
      <div class="form-grid">
        <label for="lora-mode">Mode</label>
        <select id="lora-mode">
          <option value="FSK2">FSK2</option>
          <option value="FSK4">FSK4</option>
        </select>

        <label for="lora-rate">Rate</label>
        <select id="lora-rate">
          <option value="500">500</option>
          <option value="200">200</option>
          <option value="100">100</option>
          <option value="50">50</option>
          <option value="20">20</option>
        </select>

        <label for="freedv-ldpc">LDPC</label>
        <select id="freedv-ldpc">
          <option value="768/256">768/256</option>
          <option value="512/256">512/256</option>
        </select>
      </div>
    </div>

    <div class="form-actions">
      <div id="freedv-hint" class="hint"></div>
    </div>
  `;a.firstChild;)i.appendChild(a.firstChild);s.appendChild(i),c("freedv-mode").value=t.mode,c("freedv-rate").value=String(t.rate),c("freedv-ldpc").value=t.ldpc;let l=c("freedv-hint"),d=c("if-save-btn");le(d,n("saving"));let g={...t};function p(){return{mode:c("freedv-mode").value,rate:c("freedv-rate").value,ldpc:c("freedv-ldpc").value}}function h(f){let w=["FSK2","FSK4"],E=["500","200","100","50","20"],y=["768/256","512/256"];return w.includes(String(f.mode))?E.includes(String(f.rate))?y.includes(String(f.ldpc))?null:n("invalid_ldpc"):n("invalid_rate"):n("invalid_mode")}function b(f){return String(g.mode).toUpperCase()!==String(f.mode).toUpperCase()||String(g.rate)!==String(f.rate)||String(g.ldpc)!==String(f.ldpc)}function r(){let f=p(),w=h(f);w?(l.textContent=w,l.className="hint error"):b(f)?(l.textContent=n("unsaved_changes"),l.className="hint"):(l.textContent="",l.className="hint"),d.disabled=M()||!!w||!b(f)}["freedv-mode","freedv-rate","freedv-ldpc"].forEach(f=>{c(f).addEventListener("change",r)}),r(),Z=async()=>{let f=p(),w=h(f);if(w){l.textContent=w,l.className="hint error";return}let E=!1;try{let y=d.offsetWidth;y&&(d.style.width=`${y}px`),d.disabled=!0,d.textContent=n("saving"),S("busy",""),await B.postForm("/freedv/apply",f),l.textContent=n("saved"),l.className="hint success",S("ok",n("freedv_applied")),g={...f},E=!0}catch(y){l.textContent=`${n("save_error")}: ${y?.message||y}`,l.className="hint error",S("error",n("freedv_save_error"))}finally{d.disabled=M()||E,d.textContent=n("save"),d.style.width="",d.disabled||r()}}}function Je(e){let s=c("content-body"),t={mode:e?.mode?.toUpperCase?.()==="FSK4"?"FSK4":"FSK2",rate:String(e?.rate??"500"),ldpc:e?.ldpc==="512/256"?"512/256":"768/256"};s.innerHTML="";let i=document.createElement("div");i.className="form";let a=document.createElement("div");for(a.innerHTML=`
    <div class="form-section">
      <div class="form-title">FreeDV</div>
      <div class="form-grid">
        <label for="freedv-mode">Mode</label>
        <select id="freedv-mode">
          <option value="FSK2">FSK2</option>
          <option value="FSK4">FSK4</option>
        </select>

        <label for="freedv-rate">Rate</label>
        <select id="freedv-rate">
          <option value="500">500</option>
          <option value="200">200</option>
          <option value="100">100</option>
          <option value="50">50</option>
          <option value="20">20</option>
        </select>

        <label for="freedv-ldpc">LDPC</label>
        <select id="freedv-ldpc">
          <option value="768/256">768/256</option>
          <option value="512/256">512/256</option>
        </select>
      </div>
    </div>

    <div class="form-actions">
      <div id="freedv-hint" class="hint"></div>
    </div>
  `;a.firstChild;)i.appendChild(a.firstChild);s.appendChild(i),c("freedv-mode").value=t.mode,c("freedv-rate").value=String(t.rate),c("freedv-ldpc").value=t.ldpc;let l=c("freedv-hint"),d=c("if-save-btn");le(d,n("saving"));let g={...t};function p(){return{mode:c("freedv-mode").value,rate:c("freedv-rate").value,ldpc:c("freedv-ldpc").value}}function h(f){let w=["FSK2","FSK4"],E=["500","200","100","50","20"],y=["768/256","512/256"];return w.includes(String(f.mode))?E.includes(String(f.rate))?y.includes(String(f.ldpc))?null:n("invalid_ldpc"):n("invalid_rate"):n("invalid_mode")}function b(f){return String(g.mode).toUpperCase()!==String(f.mode).toUpperCase()||String(g.rate)!==String(f.rate)||String(g.ldpc)!==String(f.ldpc)}function r(){let f=p(),w=h(f);w?(l.textContent=w,l.className="hint error"):b(f)?(l.textContent=n("unsaved_changes"),l.className="hint"):(l.textContent="",l.className="hint"),d.disabled=M()||!!w||!b(f)}["freedv-mode","freedv-rate","freedv-ldpc"].forEach(f=>{c(f).addEventListener("change",r)}),r(),Z=async()=>{let f=p(),w=h(f);if(w){l.textContent=w,l.className="hint error";return}let E=!1;try{let y=d.offsetWidth;y&&(d.style.width=`${y}px`),d.disabled=!0,d.textContent=n("saving"),S("busy",""),await B.postForm("/freedv/apply",f),l.textContent=n("saved"),l.className="hint success",S("ok",n("freedv_applied")),g={...f},E=!0}catch(y){l.textContent=`${n("save_error")}: ${y?.message||y}`,l.className="hint error",S("error",n("freedv_save_error"))}finally{d.disabled=M()||E,d.textContent=n("save"),d.style.width="",d.disabled||r()}}}function vt(e){let s=c("content-body");s.innerHTML="";let t=document.createElement("div");t.className="form";let i=document.createElement("div");i.className="form-section",i.innerHTML=`<div class="form-title">${n("user_management")}</div>`;let a=e&&e.users||[],l=document.createElement("table");l.className="users-table";let d=document.createElement("thead");d.innerHTML=`
        <tr>
            <th>${n("username")}</th>
            <th style="text-align:center">${n("is_admin")}</th>
            <th style="text-align:right"></th>
        </tr>
    `,l.appendChild(d);let g=document.createElement("tbody");a.forEach(y=>{let L=document.createElement("tr");L.innerHTML=`
            <td>${y.username}</td>
            <td style="text-align:center">${y.is_admin?"\u2705":""}</td>
            <td style="text-align:right">
                ${y.username!==Q.getInstance().getCurrentUser()?`<button class="btn btn-sm danger del-user" data-username="${y.username}">${n("delete")}</button>`:""}
            </td>
        `,g.appendChild(L)}),l.appendChild(g),i.appendChild(l);let p=document.createElement("div");p.className="form-section",p.innerHTML=`<div class="form-title">${n("add_user")}</div>`;let h=document.createElement("div");h.className="form-grid";let b=document.createElement("label");b.textContent=n("username");let r=document.createElement("input");r.type="text";let f=document.createElement("label");f.textContent=n("password_label");let w=document.createElement("input");w.type="password";let E=document.createElement("button");E.className="btn primary",E.textContent=n("add"),h.appendChild(b),h.appendChild(r),h.appendChild(f),h.appendChild(w),h.appendChild(document.createElement("div")),h.appendChild(E),p.appendChild(h),t.appendChild(i),t.appendChild(p),s.appendChild(t),E.addEventListener("click",async()=>{let y=r.value,L=w.value;if(!(!y||!L))try{S("busy",""),await B.postForm("/auth/register",{username:y,password:L}),Ie("ok",n("saved")),ue("users")}catch(_){S("error",_.message)}}),g.querySelectorAll(".del-user").forEach(y=>{y.addEventListener("click",async()=>{let L=y.getAttribute("data-username");if(L&&confirm(`Delete user ${L}?`))try{S("busy",""),await B.postForm("/auth/delete",{username:L}),Ie("ok",n("saved")),ue("users")}catch(_){S("error",_.message)}})})}});wt();})();
//# sourceMappingURL=bundle.js.map
