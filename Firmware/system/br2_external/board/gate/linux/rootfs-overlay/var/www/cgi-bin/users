#!/usr/bin/env python3
import os
import sys
import json

BASE = "/var/www/cgi-bin"
USERS_FILE = os.path.join(BASE, "user.db")
SESSIONS_FILE = os.path.join(BASE, "session.db")

# -------------------- helpers --------------------
def respond(obj, code=200):
    print(f"Status: {code}")
    print("Content-Type: application/json\n")
    print(json.dumps(obj))
    sys.exit(0)

def load_users():
    users = {}
    if os.path.exists(USERS_FILE):
        with open(USERS_FILE) as f:
            for line in f:
                if not line.strip():
                    continue
                u, _, a = line.strip().split(":")
                users[u] = {"is_admin": a == "1"}
    return users

# -------------------- dispatcher --------------------
path = os.environ.get("PATH_INFO", "")

if path == "/info":
    users = load_users()
    users_list = [{"username": u, "is_admin": info["is_admin"]} for u, info in users.items()]
    respond({"users": users_list})

else:
    respond({"error": "invalid endpoint"}, code=404)
